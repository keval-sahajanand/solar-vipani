<%- include('header') %>

  <div class="col-span-5 lg:col-span-4 rounded-xl overflow-y-scroll p-2 sm:p-4 lg:p-5 xl:p-9"
    style="background: #dfdff773;">
    <div>
      <div class="grid grid-cols-1 sm:grid-cols-4  mb-5 lg:mb-10 px-2 mt-3">
        <div class="text-center sm:text-left col-span-3 my-auto mb-3 sm:mb-0">
          <h2 class="text-2xl font-medium lg:text-3xl lg:font-semibold">Business Review List</h2>
        </div>
        <div class="text-center sm:text-right my-auto">

          <button  class="addbtnstyle" id="downloadBtn">Download CSV</button>
        </div>
      </div>

      <div>
        <div class="p-5 bg-white rounded-xl">
          <table class="table-fixed lg:w-full montabel" id="datatablemain">
            <thead>
              <tr>
                <th>Business Name</th>
                <th>Rating</th>
                <th>Review Title</th>
                <th>pincode</th>
                <th>Date Of Installation</th>
                <th>Size Of System</th>
                <th>Solar Panel Brand</th>
                <th>Inverter Brand</th>
                <th>Mobile Number</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <% data.forEach((data)=>{ %>
                <tr>
                  <td style="word-break: break-word"><%- data.businessName %></td>
                  <td style="word-break: break-word"><%- data.star %></td>
                  <td style="word-break: break-word"><%- data.reviewTitle %></td>
                  <td style="word-break: break-word"><%- data.pincode %></td>
                  <td style="word-break: break-word"><%- data.dateOfInstallation %></td>
                  <td style="word-break: break-word"><%- data.sizeOfSystem %></td>
                  <td style="word-break: break-word"><%- data.solarPanelBrand %></td>
                  <td style="word-break: break-word"><%- data.inverterBrand %></td>
                  <td style="word-break: break-word"><%- data.mobileNumber %></td>

                  <td>
                    <a class="p-2 cursor-pointer"
                      onclick="editapplicationmodel({businessName:'<%-btoa(data.businessName)%>',displayName:'<%- data.displayName%>',star:'<%- data.star %>',id:'<%- data.id %>',reviewTitle:'<%- btoa(data.reviewTitle)%>',reviewDescription:'<%- btoa(data.reviewDescription) %>',pincode:'<%- data.pincode %>',dateOfInstallation:'<%- data.dateOfInstallation%>',sizeOfSystem:'<%- data.sizeOfSystem%>',solarPanelBrand:'<%- data.solarPanelBrand %>',inverterBrand:'<%- data.inverterBrand %>',mobileNumber:'<%- data.mobileNumber %>',comment:'<%- btoa(data.comment)%>'})"><i
                        class="fa-solid fa-pen-to-square" style="color: #25d366;"></i></a>
                    <a class="p-2 cursor-pointer" onclick="deletemodel({id:'<%- data.id %>'})"><i
                        class="fa-solid fa-trash" style="color: #e9562a;"></i></a>
                  </td>
                </tr>
                <% }) %>
            </tbody>
          </table>
        </div>
        <!-- Edit Model -->
        <div class="absolute inset-0 backdrop-blur-xl rounded-xl p-3 lg:p-10 grid overflow-scroll hidden"
          id="editpopupmodul" style="background: #b5b8c570;">
          <div class="bg-white w-6/6 lg:w-4/12 m-auto rounded-2xl relative">
            <div>
              <form>
                <div class="grid grid-cols-4 p-4 lg:p-6" style="border-bottom: 5px solid #cfd1e0;">
                  <div class="col-span-3">
                    <div class="text-base lg:text-xl font-semibold">View Business Review</div>
                  </div>
                  <div class="text-right my-auto"><i class="fa-solid fa-xmark lg:text-lg cursor-pointer"
                      onclick="editapplicationmodelremove()"></i></div>
                </div>
                <div class="p-4 lg:p-6">
                  <div>
                    <div class="mb-1 lg:mb-3">
                      <div class="text-sm lg:text-base font-medium mb-1 text-left">Business Name</div>
                      <div><input type="text" name="businessName" id="businessName-edit" class="textfiled" required
                          readonly>
                      </div>
                    </div>
                    <div class="mb-1 lg:mb-3">
                      <div class="text-sm lg:text-base font-medium mb-1 text-left">Star</div>
                      <div>
                        <input type="text" name="star" id="star-edit" class="textfiled" required readonly>

                      </div>
                    </div>
                    <div class="mb-1 lg:mb-3">
                      <div class="text-sm lg:text-base font-medium mb-1 text-left">Review Title</div>
                      <div>
                        <input type="text" name="reviewTitle" id="reviewTitle-edit" class="textfiled" required readonly>
                      </div>
                    </div>
                    <div class="mb-1 lg:mb-3">
                      <div class="text-sm lg:text-base font-medium mb-1 text-left">Review Description
                      </div>
                      <div>
                        <textarea name="reviewDescription" id="reviewDescription-edit" class="textfiled"
                        required readonly></textarea>
                        
                      </div>
                    </div>
                    <div class="mb-1 lg:mb-3">
                      <div class="text-sm lg:text-base font-medium mb-1 text-left">Display Name</div>
                      <div>
                        <input type="email" name="displayName" id="displayName-edit" class="textfiled" readonly>
                      </div>
                    </div>
                    <div class="mb-1 lg:mb-3">
                      <div class="text-sm lg:text-base font-medium mb-1 text-left">Pincode</div>
                      <div>
                        <input type="text" name="pincode" id="pincode-edit" class="textfiled" readonly>
                      </div>
                    </div>
                    <div class="mb-1 lg:mb-3">
                      <div class="text-sm lg:text-base font-medium mb-1 text-left">Date Of Installation
                      </div>
                      <div>
                        <input type="text" name="dateOfInstallation" id="dateOfInstallation-edit" class="textfiled"
                          required readonly>
                      </div>
                    </div>
                    <div class="mb-1 lg:mb-3">
                      <div class="text-sm lg:text-base font-medium mb-1 text-left">Size Of System</div>
                      <div>
                        <input type="text" name="sizeOfSystem" id="sizeOfSystem-edit" class="textfiled" required
                          readonly>
                      </div>
                    </div>
                    <div class="mb-1 lg:mb-3">
                      <div class="text-sm lg:text-base font-medium mb-1 text-left">Solar Panel Brand</div>
                      <div>
                        <input type="text" name="solarPanelBrand" id="solarPanelBrand-edit" class="textfiled" required
                          readonly>
                      </div>
                    </div>

                    <div class="mb-1 lg:mb-3">
                      <div class="text-sm lg:text-base font-medium mb-1 text-left">Inverter Brand</div>
                      <div>
                        <input type="text" name="inverterBrand" id="inverterBrand-edit" class="textfiled" required
                          readonly>
                      </div>
                    </div>
                    <div class="mb-1 lg:mb-3">
                      <div class="text-sm lg:text-base font-medium mb-1 text-left">Mobile Number</div>
                      <div>
                        <input type="text" name="obileNumber" id="mobileNumber-edit" class="textfiled" required
                          readonly>
                      </div>
                    </div>
                    <div class="mb-1 lg:mb-3">
                      <div class="text-sm lg:text-base font-medium mb-1 text-left">Comment</div>
                      <div>

                        <textarea name="comment" id="comment-edit" class="textfiled"  required readonly></textarea>

                      </div>
                    </div>

                  </div>
                </div>
                <div class="p-2 lg:p-4 text-center" style="border-top: 5px solid #cfd1e0;">
                  <input type="hidden" name="id" id="id-edit">
                  <!-- <input type="submit" value="Save Edit"
                    class="px-4 py-2 text-white rounded-lg tracking-wider formsubmit font-medium cursor-pointer"> -->
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- delete model -->
        <div class="absolute inset-0 backdrop-blur-xl rounded-xl p-3 lg:p-10 grid overflow-scroll hidden"
          id="deleteCategoryModel" style="background: #b5b8c570;">
          <div class="bg-white w-6/6 lg:w-4/12 m-auto rounded-2xl relative">
            <div>

              <div class="grid grid-cols-4 p-4 lg:p-6" style="border-bottom: 5px solid #cfd1e0;">
                <div class="col-span-3">
                  <div class="text-base lg:text-xl font-semibold">Delete Business Review </div>
                </div>
                <div class="text-right my-auto"><i class="fa-solid fa-xmark   lg:text-lg cursor-pointer"
                    onclick="deleteCategoryremove()"></i></div>
              </div>
              <div class="p-4 lg:p-6">
                <div class="mb-1 lg:mb-3">
                  <div class="text-sm lg:text-base font-medium mb-1 text-center">Are you sure Business
                    Review delete?</div>
                </div>
              </div>
              <div class="  text-center" style="margin-bottom: 15px">
                <a style="background-color: #cb4545" id="deleteurl" href=""
                  class="px-4 py-2 text-white rounded-lg tracking-wider formsubmit font-medium cursor-pointer">Delete</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    function editapplicationmodel(data) {
      console.log(data);
      document.getElementById("businessName-edit").value = atob(data.businessName);
      document.getElementById("comment-edit").value = atob(data.comment);
      document.getElementById("dateOfInstallation-edit").value = data.dateOfInstallation;
      document.getElementById("star-edit").value = data.star;

      document.getElementById("inverterBrand-edit").value = data.inverterBrand;
      document.getElementById("mobileNumber-edit").value = data.mobileNumber;
      document.getElementById("pincode-edit").value = data.pincode;
      document.getElementById("reviewDescription-edit").value = atob(data.reviewDescription);
      document.getElementById("reviewTitle-edit").value = atob(data.reviewTitle);
      document.getElementById("sizeOfSystem-edit").value = data.sizeOfSystem;
      document.getElementById("solarPanelBrand-edit").value = data.solarPanelBrand;
      document.getElementById("displayName-edit").value = data.displayName;
      document.getElementById("id-edit").value = data.id;


      const classgetmodul = document.getElementById('editpopupmodul');
      classgetmodul.classList.remove("hidden");
    }

    function editapplicationmodelremove() {
      const classgetmodul = document.getElementById('editpopupmodul');
      classgetmodul.classList.add("hidden");
    }

    function newaddapplication() {
      const classgetmodul = document.getElementById('newaddapplication');
      classgetmodul.classList.remove("hidden");
    }

    function newaddapplicationremove() {
      const classgetmodul = document.getElementById('newaddapplication');
      classgetmodul.classList.add("hidden");
    }
  </script>

  <!-- Delete and add model -->
  <script>
    function newaddapplication() {
      const classgetmodul = document.getElementById('newaddapplication');
      classgetmodul.classList.remove("hidden");
    }

    function newaddapplicationremove() {
      const classgetmodul = document.getElementById('newaddapplication');
      classgetmodul.classList.add("hidden");
    }

    function deletemodel(data) {
      document.getElementById("deleteurl").href = `/admin/business-review/${data.id}/delete`;

      const classgetmodul = document.getElementById('deleteCategoryModel');
      classgetmodul.classList.remove("hidden");
    }
    function deleteCategoryremove() {
      const classgetmodul = document.getElementById('deleteCategoryModel');
      classgetmodul.classList.add("hidden");
    }
  </script>



  <script>
    document.getElementById('downloadBtn').addEventListener('click', async () => {
      try {
        const tableName = 'business_reviews';
        if (!tableName) return;
        const response = await fetch(`/download/${tableName}`);

        const a = document.createElement('a');
        a.href = `https://admin.solarvipani.com/csv/${tableName}.csv`;
        a.download = `${tableName}.csv`;
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);
      } catch (error) {
        // console.error('Error:', error);
      }
    });
  </script>


  <%- include('footer') %>