<%- include('header') %>

    <div class="col-span-5 lg:col-span-4 rounded-xl overflow-y-scroll p-2 sm:p-4 lg:p-5 xl:p-9"
        style="background: #dfdff773;">
        <div>
            <div class="grid grid-cols-1 sm:grid-cols-4  mb-5 lg:mb-10 px-2 mt-3">

                <div class="text-center sm:text-left col-span-3 my-auto mb-3 sm:mb-0">
                    <h2 class="text-2xl font-medium lg:text-3xl lg:font-semibold">Business List</h2>
                </div>
                <div class="text-center sm:text-right my-auto" style="display: flex;align-items: center;">

                    <button style="margin-right: 10px;" class="addbtnstyle" id="downloadBtn">Download CSV</button>

                    <button class="addbtnstyle" onclick="newaddapplication()">Add Business List</button>
                    <div class="absolute inset-0 backdrop-blur-xl rounded-xl p-3 lg:p-10 grid overflow-scroll hidden z-20"
                        id="newaddapplication" style="background: #b5b8c570;">
                        <div class="bg-white w-6/6 lg:w-4/12 m-auto rounded-2xl relative">
                            <form method="POST" action="/admin/business" id="businessForm">
                                <div class="grid grid-cols-4 p-4 lg:p-6" style="border-bottom: 5px solid #cfd1e0;">
                                    <div class="col-span-3">
                                        <div class="text-base lg:text-xl font-semibold text-left">Create New Business
                                        </div>
                                    </div>
                                    <div class="text-right my-auto"><i
                                            class="fa-solid fa-xmark lg:text-lg cursor-pointer"
                                            onclick="newaddapplicationremove()"></i></div>
                                </div>
                                <div class="p-4 lg:p-6">
                                    <div>

                                        <div class="mb-1 lg:mb-3">
                                            <div class="text-sm lg:text-base font-medium mb-1 text-left">Name</div>
                                            <div>
                                                <!-- <input type="text" name="name" id="name" class="textfiled" required> -->
                                                <input type="text" name="name" id="name" class="textfiled" required
                                                    oninput="generateSlug()">
                                            </div>
                                        </div>
                                        <div class="mb-1 lg:mb-3">
                                            <div class="text-sm lg:text-base font-medium mb-1 text-left">Slug</div>
                                            <div><input type="text" name="slug" id="slug" class="textfiled" required>
                                            </div>
                                        </div>
                                        <div class="mb-1 lg:mb-3">
                                            <div class="text-sm lg:text-base font-medium mb-1 text-left">Address</div>
                                            <div>
                                                <textarea name="address" id="address" class="textfiled" cols="5"
                                                    rows="2"></textarea>
                                            </div>
                                        </div>
                                        <div class="mb-1 lg:mb-3">
                                            <div class="text-sm lg:text-base font-medium mb-1 text-left">Map Pin</div>
                                            <div>
                                                <input type="text" name="mapPin" id="mapPin" class="textfiled">
                                            </div>
                                        </div>
                                        <div class="mb-1 lg:mb-3">
                                            <div class="text-sm lg:text-base font-medium mb-1 text-left">Phone Number
                                            </div>
                                            <div>
                                                <input type="tel" name="phoneNumber" id="phoneNumber" class="textfiled"
                                                    pattern="[0-9]{10}" maxlength="15"
                                                    title="Please enter 10 digit phone number" required>
                                                <span class="error-msg" id="phoneError"></span>
                                            </div>
                                        </div>
                                        <div class="mb-1 lg:mb-3">
                                            <div class="text-sm lg:text-base font-medium mb-1 text-left">Email</div>
                                            <div>
                                                <input type="email" name="email" id="email" class="textfiled">
                                            </div>
                                        </div>
                                        <div class="mb-1 lg:mb-3">
                                            <div class="text-sm lg:text-base font-medium mb-1 text-left">Web site</div>
                                            <div>
                                                <input type="text" name="website" id="website" class="textfiled">
                                            </div>
                                        </div>
                                        <div class="mb-1 lg:mb-3">
                                            <div class="text-sm lg:text-base font-medium mb-1 text-left">GSTN Number
                                            </div>
                                            <div>
                                                <input type="text" name="gstnNumber" id="gstnNumber" class="textfiled">
                                            </div>

                                        </div>

                                        <div class="mb-1 lg:mb-3">
                                            <div class="text-sm lg:text-base font-medium mb-1 text-left">Tag
                                            </div>
                                            <div>
                                                <select name="note" id="note" class="textfiled" required>
                                                    <option value="">Select Note</option>
                                                    <option value="Blank">Blank</option>
                                                    <option value="Preferred Partner">Preferred Partner</option>
                                                    <option value="Verified Installer">Verified Installer</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div class="mb-1 lg:mb-3">
                                            <div class="text-sm lg:text-base font-medium mb-1 text-left">State
                                            </div>
                                            <div>
                                                <select name="state" id="state" class="textfiled" required
                                                    onchange="toggleDistrictInput()">
                                                    <option value="">Select State</option>
                                                    <option value="Andhra Pradesh">Andhra Pradesh</option>
                                                    <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                                    <option value="Assam">Assam</option>
                                                    <option value="Bihar">Bihar</option>
                                                    <option value="Chhattisgarh">Chhattisgarh</option>
                                                    <option value="Goa">Goa</option>
                                                    <option value="Gujarat">Gujarat</option>
                                                    <option value="Haryana">Haryana</option>
                                                    <option value="Himachal Pradesh">Himachal Pradesh</option>
                                                    <option value="JammuKashmir">Jammu Kashmir</option>
                                                    <option value="Jharkhand">Jharkhand</option>
                                                    <option value="Karnataka">Karnataka</option>
                                                    <option value="Kerala">Kerala</option>
                                                    <option value="Madhya Pradesh">Madhya Pradesh</option>
                                                    <option value="Maharashtra">Maharashtra</option>
                                                    <option value="Manipur">Manipur</option>
                                                    <option value="Meghalaya">Meghalaya</option>
                                                    <option value="Mizoram">Mizoram</option>
                                                    <option value="Nagaland">Nagaland</option>
                                                    <option value="Odisha">Odisha</option>
                                                    <option value="Punjab">Punjab</option>
                                                    <option value="Rajasthan">Rajasthan</option>
                                                    <option value="Sikkim">Sikkim</option>
                                                    <option value="TamilNadu">Tamil Nadu</option>
                                                    <option value="Telangana">Telangana</option>
                                                    <option value="Tripura">Tripura</option>
                                                    <option value="Uttar Pradesh">Uttar Pradesh</option>
                                                    <option value="Uttarakhand">Uttarakhand</option>
                                                    <option value="WestBengal">West Bengal</option>
                                                    <option value="AndamanNicobar">Andaman Nicobar</option>
                                                    <option value="Chandigarh">Chandigarh</option>
                                                    <option value="Dadra And Nagar Haveli And DamanAndDiu">Dadra and
                                                        Nagar
                                                        Haveli and Daman and Diu</option>
                                                    <option value="Delhi">Delhi</option>
                                                    <option value="Lakshadweep">Lakshadweep</option>
                                                    <option value="Ladakh">Ladakh</option>
                                                    <option value="Puducherry">Puducherry</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div class="mb-1 lg:mb-3" id="district-div" style="display: none;">
                                            <div class="text-sm lg:text-base font-medium mb-1 text-left">District
                                            </div>
                                            <div>
                                                <select name="district" id="district" class="textfiled"
                                                    onchange="toggleDistrictNewInput()" required>

                                                </select>
                                            </div>
                                        </div>

                                        <div class="mb-1 lg:mb-3" id="districtNew-div" style="display: none;">
                                            <div class="text-sm lg:text-base font-medium mb-1 text-left">City/Town/Area
                                            </div>
                                            <div>
                                                <select name="districtNew" id="districtNew" class="textfiled" required>

                                                </select>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                                <div class="p-2 lg:p-4 text-center" style="border-top: 5px solid #cfd1e0;">
                                    <input type="submit" value="Save"
                                        class="px-4 py-2 text-white rounded-lg tracking-wider formsubmit font-medium cursor-pointer">
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <div>
                <div class="p-5 bg-white rounded-xl">
                    <div class="mb-1 lg:mb-3">
                        <div class="text-sm lg:text-base font-medium mb-1 text-left">State</div>
                        <div>
                            <select name="stateapi" id="stateapi" class="textfiled" required onchange="selectState()">
                                <option value="">Select State</option>
                                <option value="Andhra Pradesh" <% if(state==='Andhra Pradesh' ) { %>selected<% } %>
                                        >Andhra Pradesh</option>
                                <option value="Arunachal Pradesh" <% if(state==='Arunachal Pradesh' ) { %>selected<% }
                                        %>>Arunachal Pradesh</option>
                                <option value="Assam" <% if(state==='Assam' ) { %>selected<% } %>>Assam</option>
                                <option value="Bihar" <% if(state==='Bihar' ) { %>selected<% } %>>Bihar</option>
                                <option value="Chhattisgarh" <% if(state==='Chhattisgarh' ) { %>selected<% } %>
                                        >Chhattisgarh</option>
                                <option value="Goa" <% if(state==='Goa' ) { %>selected<% } %>>Goa</option>
                                <option value="Gujarat" <% if(state==='Gujarat' ) { %>selected<% } %>>Gujarat</option>
                                <option value="Haryana" <% if(state==='Haryana' ) { %>selected<% } %>>Haryana</option>
                                <option value="Himachal Pradesh" <% if(state==='Himachal Pradesh' ) { %>selected<% } %>
                                        >Himachal Pradesh</option>
                                <option value="Jharkhand" <% if(state==='Jharkhand' ) { %>selected<% } %>>Jharkhand
                                </option>
                                <option value="Karnataka" <% if(state==='Karnataka' ) { %>selected<% } %>>Karnataka
                                </option>
                                <option value="Kerala" <% if(state==='Kerala' ) { %>selected<% } %>>Kerala</option>
                                <option value="Madhya Pradesh" <% if(state==='Madhya Pradesh' ) { %>selected<% } %>
                                        >Madhya Pradesh</option>
                                <option value="Maharashtra" <% if(state==='Maharashtra' ) { %>selected<% } %>
                                        >Maharashtra</option>
                                <option value="Manipur" <% if(state==='Manipur' ) { %>selected<% } %>>Manipur</option>
                                <option value="Meghalaya" <% if(state==='Meghalaya' ) { %>selected<% } %>>Meghalaya
                                </option>
                                <option value="Mizoram" <% if(state==='Mizoram' ) { %>selected<% } %>>Mizoram</option>
                                <option value="Nagaland" <% if(state==='Nagaland' ) { %>selected<% } %>>Nagaland
                                </option>
                                <option value="Odisha" <% if(state==='Odisha' ) { %>selected<% } %>>Odisha</option>
                                <option value="Punjab" <% if(state==='Punjab' ) { %>selected<% } %>>Punjab</option>
                                <option value="Rajasthan" <% if(state==='Rajasthan' ) { %>selected<% } %>>Rajasthan
                                </option>
                                <option value="Sikkim" <% if(state==='Sikkim' ) { %>selected<% } %>>Sikkim</option>
                                <option value="Tamil Nadu" <% if(state==='Tamil Nadu' ) { %>selected<% } %>>Tamil Nadu
                                </option>
                                <option value="Telangana" <% if(state==='Telangana' ) { %>selected<% } %>>Telangana
                                </option>
                                <option value="Tripura" <% if(state==='Tripura' ) { %>selected<% } %>>Tripura</option>
                                <option value="Uttar Pradesh" <% if(state==='Uttar Pradesh' ) { %>selected<% } %>>Uttar
                                        Pradesh</option>
                                <option value="Uttarakhand" <% if(state==='Uttarakhand' ) { %>selected<% } %>
                                        >Uttarakhand</option>
                                <option value="WestBengal" <% if(state==='WestBengal' ) { %>selected<% } %>>West Bengal
                                </option>
                                <option value="Andaman Nicobar" <% if(state==='Andaman Nicobar' ) { %>selected<% } %>
                                        >Andaman Nicobar</option>
                                <option value="Chandigarh" <% if(state==='Chandigarh' ) { %>selected<% } %>>Chandigarh
                                </option>
                                <option value="Dadra And Nagar Haveli And Daman And Diu" <%
                                    if(state==='Dadra And Nagar Haveli And Daman And Diu' ) { %>selected<% } %>>Dadra
                                        and Nagar Haveli and Daman and Diu</option>
                                <option value="Delhi" <% if(state==='Delhi' ) { %>selected<% } %>>Delhi</option>
                                <option value="Lakshadweep" <% if(state==='Lakshadweep' ) { %>selected<% } %>
                                        >Lakshadweep</option>
                                <option value="Ladakh" <% if(state==='Ladakh' ) { %>selected<% } %>>Ladakh</option>
                                <option value="Puducherry" <% if(state==='Puducherry' ) { %>selected<% } %>>Puducherry
                                </option>
                            </select>
                        </div>
                    </div>
                    <table class="table-fixed lg:w-full montabel" id="datatablemain">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Phone Number</th>
                                <th>Email</th>
                                <th>Website</th>
                                <th>GSTN Number</th>
                                <th>Helpful</th>
                                <th>Not Helpful</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% data.forEach((data)=>{ %>
                                <tr>
                                    <td style="word-break: break-word"><%- data.name %></td>
                                    <td style="word-break: break-word"><%- data.phoneNumber %></td>
                                    <td style="word-break: break-word"><%- data.email %></td>
                                    <td style="word-break: break-word"><a href="<%- data.website %>"><%- data.website
                                                %></a></td>
                                    <td style="word-break: break-word"><%- data.gstnNumber %></td>
                                    <td style="word-break: break-word"><%- data.usefull %></td>
                                    <td style="word-break: break-word"><%- data.unUsefull %></td>
                                    <td>

                                        <a href="/admin/business-edit/<%- data.id %>" class="p-2 cursor-pointer"> <i
                                                class="fa-solid fa-pen-to-square" style="color: #25d366;"></i></a>
                                        <a class="p-2 cursor-pointer" onclick="deletemodel({id:'<%- data.id %>'})"><i
                                                class="fa-solid fa-trash" style="color: #e9562a;"></i></a>
                                    </td>
                                </tr>
                                <% }) %>
                        </tbody>
                    </table>
                </div>
                <!-- Edit Model -->
                <div class="absolute inset-0 backdrop-blur-xl rounded-xl p-3 lg:p-10 grid overflow-scroll hidden"
                    id="editpopupmodul" style="background: #b5b8c570;">
                    <div class="bg-white w-6/6 lg:w-4/12 m-auto rounded-2xl relative">
                        <div>
                            <form action="/admin/business/edit" method="POST">
                                <div class="grid grid-cols-4 p-4 lg:p-6" style="border-bottom: 5px solid #cfd1e0;">
                                    <div class="col-span-3">
                                        <div class="text-base lg:text-xl font-semibold">Edit Business List</div>
                                    </div>
                                    <div class="text-right my-auto"><i
                                            class="fa-solid fa-xmark lg:text-lg cursor-pointer"
                                            onclick="editapplicationmodelremove()"></i></div>
                                </div>
                                <div class="p-4 lg:p-6">
                                    <div>
                                        <div class="mb-1 lg:mb-3">
                                            <div class="text-sm lg:text-base font-medium mb-1 text-left">Name</div>
                                            <div><input type="text" name="name" id="name-edit" class="textfiled"
                                                    required>
                                            </div>
                                        </div>
                                        <div class="mb-1 lg:mb-3">
                                            <div class="text-sm lg:text-base font-medium mb-1 text-left">Slug</div>
                                            <div><input type="text" name="slug" id="slug-edit" class="textfiled"
                                                    required>
                                            </div>
                                        </div>
                                        <div class="mb-1 lg:mb-3">
                                            <div class="text-sm lg:text-base font-medium mb-1 text-left">Address</div>
                                            <div>
                                                <textarea type="text" class="textfiled" name="address" id="address-edit"
                                                    cols="5" rows="2"></textarea>
                                            </div>
                                        </div>
                                        <div class="mb-1 lg:mb-3">
                                            <div class="text-sm lg:text-base font-medium mb-1 text-left">Map Pin</div>
                                            <div>
                                                <input type="text" name="mapPin" id="mapPin-edit" class="textfiled">
                                            </div>
                                        </div>
                                        <div class="mb-1 lg:mb-3">
                                            <div class="text-sm lg:text-base font-medium mb-1 text-left">Phone Number
                                            </div>
                                            <div>
                                                <input type="tel" name="phoneNumber" id="phoneNumber-edit"
                                                    pattern="[0-9]{10}" maxlength="10"
                                                    title="Please enter 10 digit phone number" class="textfiled"
                                                    required>
                                                <span class="error-msg" id="phoneError-edit"></span>
                                            </div>
                                        </div>
                                        <div class="mb-1 lg:mb-3">
                                            <div class="text-sm lg:text-base font-medium mb-1 text-left">Email</div>
                                            <div>
                                                <input type="email" name="email" id="email-edit" class="textfiled">
                                            </div>
                                        </div>
                                        <div class="mb-1 lg:mb-3">
                                            <div class="text-sm lg:text-base font-medium mb-1 text-left">Web site</div>
                                            <div>
                                                <input type="text" name="website" id="website-edit" class="textfiled">
                                            </div>
                                        </div>
                                        <div class="mb-1 lg:mb-3">
                                            <div class="text-sm lg:text-base font-medium mb-1 text-left">GSTN Number
                                            </div>
                                            <div>
                                                <input type="text" name="gstnNumber" id="gstnNumber-edit"
                                                    class="textfiled">
                                            </div>
                                        </div>

                                        <div class="mb-1 lg:mb-3">
                                            <div class="text-sm lg:text-base font-medium mb-1 text-left">Note
                                            </div>
                                            <div>
                                                <select name="note" id="edit-note" class="textfiled" required>
                                                    <option value="">Select Note</option>
                                                    <option value="Blank">Blank</option>
                                                    <option value="Preferred Partner">Preferred Partner</option>
                                                    <option value="Verified Installer">Verified Installer</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div class="mb-1 lg:mb-3">
                                            <div class="text-sm lg:text-base font-medium mb-1 text-left">State
                                            </div>
                                            <div>
                                                <select name="state" id="state-edit" class="textfiled" required
                                                    onchange="toggleDistrictInputEdit()">
                                                    <option value="">Select State</option>
                                                    <option value="AndhraPradesh">Andhra Pradesh</option>
                                                    <option value="ArunachalPradesh">Arunachal Pradesh</option>
                                                    <option value="Assam">Assam</option>
                                                    <option value="Bihar">Bihar</option>
                                                    <option value="Chhattisgarh">Chhattisgarh</option>
                                                    <option value="Goa">Goa</option>
                                                    <option value="Gujarat">Gujarat</option>
                                                    <option value="Haryana">Haryana</option>
                                                    <option value="HimachalPradesh">Himachal Pradesh</option>
                                                    <option value="JammuKashmir">Jammu Kashmir</option>
                                                    <option value="Jharkhand">Jharkhand</option>
                                                    <option value="Karnataka">Karnataka</option>
                                                    <option value="Kerala">Kerala</option>
                                                    <option value="MadhyaPradesh">Madhya Pradesh</option>
                                                    <option value="Maharashtra">Maharashtra</option>
                                                    <option value="Manipur">Manipur</option>
                                                    <option value="Meghalaya">Meghalaya</option>
                                                    <option value="Mizoram">Mizoram</option>
                                                    <option value="Nagaland">Nagaland</option>
                                                    <option value="Odisha">Odisha</option>
                                                    <option value="Punjab">Punjab</option>
                                                    <option value="Rajasthan">Rajasthan</option>
                                                    <option value="Sikkim">Sikkim</option>
                                                    <option value="TamilNadu">Tamil Nadu</option>
                                                    <option value="Telangana">Telangana</option>
                                                    <option value="Tripura">Tripura</option>
                                                    <option value="UttarPradesh">Uttar Pradesh</option>
                                                    <option value="Uttarakhand">Uttarakhand</option>
                                                    <option value="WestBengal">West Bengal</option>
                                                    <option value="AndamanNicobar">Andaman Nicobar</option>
                                                    <option value="Chandigarh">Chandigarh</option>
                                                    <option value="DadraAndNagarHaveliAndDamanAndDiu">Dadra and Nagar
                                                        Haveli and Daman and Diu</option>
                                                    <option value="Delhi">Delhi</option>
                                                    <option value="Lakshadweep">Lakshadweep</option>
                                                    <option value="Ladakh">Ladakh</option>
                                                    <option value="Puducherry">Puducherry</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="mb-1 lg:mb-3">
                                            <div class="text-sm lg:text-base font-medium mb-1 text-left">District
                                            </div>
                                            <div>
                                                <select name="district" id="district-edit" class="textfiled" required>

                                                </select>
                                            </div>
                                        </div>
                                        <div class="mb-1 lg:mb-3">
                                            <div class="text-sm lg:text-base font-medium mb-1 text-left">Add Notes</div>
                                            <div>
                                                <textarea name="notes" id="edit-notes" class="textfiled"></textarea>
                                            </div>
                                        </div>

                                        <div class="mb-1 lg:mb-3">

                                            <div class="text-sm lg:text-base font-medium mb-1 text-left"> <input
                                                    type="checkbox" name="isSubAdmin" id="isSubAdmin"> Make Partner?
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="p-2 lg:p-4 text-center" style="border-top: 5px solid #cfd1e0;">
                                    <input type="hidden" name="id" id="id-edit">
                                    <input type="submit" value="Save Edit"
                                        class="px-4 py-2 text-white rounded-lg tracking-wider formsubmit font-medium cursor-pointer">
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- delete model -->
                <div class="absolute inset-0 backdrop-blur-xl rounded-xl p-3 lg:p-10 grid overflow-scroll hidden"
                    id="deleteCategoryModel" style="background: #b5b8c570;">
                    <div class="bg-white w-6/6 lg:w-4/12 m-auto rounded-2xl relative">
                        <div>

                            <div class="grid grid-cols-4 p-4 lg:p-6" style="border-bottom: 5px solid #cfd1e0;">
                                <div class="col-span-3">
                                    <div class="text-base lg:text-xl font-semibold">Delete Business </div>
                                </div>
                                <div class="text-right my-auto"><i class="fa-solid fa-xmark   lg:text-lg cursor-pointer"
                                        onclick="deleteCategoryremove()"></i></div>
                            </div>
                            <div class="p-4 lg:p-6">
                                <div class="mb-1 lg:mb-3">
                                    <div class="text-sm lg:text-base font-medium mb-1 text-center">Are you sure Business
                                        delete?</div>
                                </div>
                            </div>
                            <div class="  text-center" style="margin-bottom: 15px">
                                <a style="background-color: #cb4545" id="deleteurl" href=""
                                    class="px-4 py-2 text-white rounded-lg tracking-wider formsubmit font-medium cursor-pointer">Delete</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function editapplicationmodel(data) {
            document.getElementById("name-edit").value = atob(data.name);
            document.getElementById("address-edit").value = atob(data.address);
            document.getElementById("mapPin-edit").value = atob(data.mapPin);
            document.getElementById("phoneNumber-edit").value = atob(data.phoneNumber);
            document.getElementById("email-edit").value = atob(data.email);
            document.getElementById("website-edit").value = atob(data.website);
            document.getElementById("gstnNumber-edit").value = atob(data.gstnNumber);
            document.getElementById("edit-note").value = atob(data.note);
            document.getElementById("slug-edit").value = atob(data.slug);
            document.getElementById("state-edit").value = atob(data.state);
            document.getElementById("edit-notes").value = atob(data.notes);

            if (data.isSubAdmin == 1) {
                document.getElementById("isSubAdmin").checked = data.isSubAdmin;
            }

            // document.getElementById("district-edit").value = data.district;
            document.getElementById("id-edit").value = data.id;

            const districtDropdownEdit = document.getElementById('district-edit');
            const a = data.district
            await fetch(`/districts/${data.state}`)
                .then(response => response.json())
                .then(data => {

                    districtDropdownEdit.innerHTML = '';

                    data.districts.forEach(district => {
                        const option = document.createElement('option');
                        option.value = district;
                        option.textContent = district;

                        if (district === a) {
                            option.selected = true;
                        }
                        districtDropdownEdit.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                });





            const classgetmodul = document.getElementById('editpopupmodul');
            classgetmodul.classList.remove("hidden");
        }

        function editapplicationmodelremove() {
            const classgetmodul = document.getElementById('editpopupmodul');
            classgetmodul.classList.add("hidden");
        }

        function newaddapplication() {
            const classgetmodul = document.getElementById('newaddapplication');
            classgetmodul.classList.remove("hidden");
        }

        function newaddapplicationremove() {
            const classgetmodul = document.getElementById('newaddapplication');
            classgetmodul.classList.add("hidden");
        }
    </script>

    <!-- Delete and add model -->
    <script>


        function newaddapplication() {
            const classgetmodul = document.getElementById('newaddapplication');
            classgetmodul.classList.remove("hidden");
        }

        function newaddapplicationremove() {
            const classgetmodul = document.getElementById('newaddapplication');
            classgetmodul.classList.add("hidden");

            document.getElementById('businessForm').reset();
        }

        function deletemodel(data) {
            document.getElementById("deleteurl").href = `/admin/business/${data.id}/delete`;

            const classgetmodul = document.getElementById('deleteCategoryModel');
            classgetmodul.classList.remove("hidden");
        }
        function deleteCategoryremove() {
            const classgetmodul = document.getElementById('deleteCategoryModel');
            classgetmodul.classList.add("hidden");
        }
    </script>

    <script>
        const phoneNumberInput = document.getElementById('phoneNumber');
        const phoneError = document.getElementById('phoneError');

        phoneNumberInput.addEventListener('input', function (event) {
            const phoneNumber = event.target.value;
            if (!isValidPhoneNumber(phoneNumber)) {
                phoneError.textContent = 'Please enter a valid 10-digit phone number';
                phoneNumberInput.setCustomValidity('Invalid');
            } else {
                phoneError.textContent = '';
                phoneNumberInput.setCustomValidity('');
            }
        });

        function isValidPhoneNumber(phoneNumber) {
            return /^\d{10}$/.test(phoneNumber);
        }

    </script>

    <script>
        const phoneNumberInputEdit = document.getElementById('phoneNumber-edit');
        const phoneErrorEdit = document.getElementById('phoneError-edit');

        phoneNumberInputEdit.addEventListener('input', function (event) {
            const phoneNumber = event.target.value;
            if (!isValidPhoneNumber(phoneNumber)) {
                phoneErrorEdit.textContent = 'Please enter a valid 10-digit phone number';
                phoneNumberInputEdit.setCustomValidity('Invalid');
            } else {
                phoneErrorEdit.textContent = '';
                phoneNumberInputEdit.setCustomValidity('');
            }
        });

        function isValidPhoneNumber(phoneErrorEdit) {
            return /^\d{10}$/.test(phoneErrorEdit);
        }

    </script>

    <!-- State select to country show -->
    <script>
        function toggleDistrictInput() {
            const stateDropdown = document.getElementById('state');
            const districtDropdown = document.getElementById('district'); // Update this line

            const selectedState = stateDropdown.value;

            if (selectedState !== '') {
                fetch(`/districts/${selectedState}`)
                    .then(response => response.json())
                    .then(data => {
                        // Clear existing options if needed
                        districtDropdown.innerHTML = '';
                        

                        data.districts.forEach(district => {
                            const option = document.createElement('option');
                            option.value = district;
                            option.textContent = district;
                            districtDropdown.appendChild(option);
                        });

                        document.getElementById('district-div').style.display = 'block';
                    })
                    .catch(error => {
                        console.error('Error fetching data:', error);
                    });
            } else {
                document.getElementById('district-div').style.display = 'none';
            }
        }

    </script>

    <script>
        function toggleDistrictNewInput() {
            const districtDropdown = document.getElementById('district');
            const districtNewDropdown = document.getElementById('districtNew');
            const selectedState = districtDropdown.value;

            // districtNewDropdown.innerHTML = '';
            // const option = document.createElement('option');
            // option.value = selectedState;
            // option.textContent = selectedState;
            // districtNewDropdown.appendChild(option);

            

            if (selectedState !== '') {
                fetch(`/citys/${selectedState}`)
                    .then(response => response.json())
                    .then(data => {
                        // Clear existing options if needed
                        districtNewDropdown.innerHTML = '';
                       
                        data.city.forEach(district => {
                            const option = document.createElement('option');
                            option.value = district;
                            option.textContent = district;
                            districtNewDropdown.appendChild(option);
                        });

                        document.getElementById('districtNew-div').style.display = 'block';
                    })
                    .catch(error => {
                        console.error('Error fetching data:', error);
                    });
            } else {
                document.getElementById('districtNew-div').style.display = 'none';
            }
        }
    </script>

    <!-- State select Edit -->
    <script>
        function toggleDistrictInputEdit() {
            const stateDropdown = document.getElementById('state-edit');
            const districtDropdown = document.getElementById('district-edit'); // Update this line

            const selectedState = stateDropdown.value;

            if (selectedState !== '') {
                fetch(`/districts/${selectedState}`)
                    .then(response => response.json())
                    .then(data => {
                        // Clear existing options if needed
                        districtDropdown.innerHTML = '';

                        data.districts.forEach(district => {
                            const option = document.createElement('option');
                            option.value = district;
                            option.textContent = district;
                            districtDropdown.appendChild(option);
                        });


                    })
                    .catch(error => {
                        console.error('Error fetching data:', error);
                    });
            }
        }

    </script>

    <!-- Download Script -->
    <script>
        document.getElementById('downloadBtn').addEventListener('click', async () => {
            try {
                const tableName = 'business_list';
                if (!tableName) return;
                const response = await fetch(`/download/${tableName}`);

                const a = document.createElement('a');
                a.href = `https://admin.solarvipani.com/csv/${tableName}.csv`;
                a.download = `${tableName}.csv`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
            } catch (error) {
                // console.error('Error:', error);
            }
        });
    </script>

    <script>
        function generateSlug() {
            var name = document.getElementById('name').value;
            var slug = name.toLowerCase().replace(/ /g, '-').replace(/[^\w-]+/g, '');
            document.getElementById('slug').value = slug;
        }
    </script>

    <script>
        function selectState() {
            const stateSelect = document.getElementById('stateapi');
            const selectedState = stateSelect.value;
            //   const selectedState = document.getElementById('state').value;
            if (selectedState !== "") {
                window.location.href = `/admin/business/${selectedState}`;
            }
        }
        function getStateNameFromUrl() {
            const url = window.location.href;
            const urlParams = new URLSearchParams(window.location.search);
            const state = urlParams.get('state');
            if (state) {
                document.getElementById('stateapi').value = state;
            }
        }
        document.addEventListener('DOMContentLoaded', function () {
            getStateNameFromUrl();
        });

    </script>


    <%- include('footer') %>